<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <title>Compare Kit</title>
    <style>
        @font-face {
            font-family: 'SamsungSSBodyKR';
            src: url('assets/SamsungSSBodyKR-Regular.ttf') format('truetype');
            font-weight: 400;
            font-style: normal;
        }

        * { margin: 0; padding: 0; box-sizing: border-box; }

        body {
            font-family: 'SamsungSSBodyKR', -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: #000;
            min-height: 100vh;
            min-height: 100dvh;
            display: flex;
            align-items: center;
            justify-content: center;
            overflow: hidden;
            color: #fff;
        }

        /* ── 상태별 화면 ── */
        .screen {
            display: none;
            width: 100%;
            height: 100vh;
            height: 100dvh;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            padding: 24px;
            text-align: center;
            background: #000 url('assets/web_background.png') center/cover no-repeat;
        }
        .screen.active { display: flex; }

        /* ── 로딩 화면 ── */
        #screen-loading {
        }
        .spinner {
            width: 48px; height: 48px;
            border: 4px solid rgba(255,255,255,0.3);
            border-top-color: #fff;
            border-radius: 50%;
            animation: spin 0.8s linear infinite;
            margin-bottom: 20px;
        }
        @keyframes spin { to { transform: rotate(360deg); } }
        .loading-text { font-size: 1.5rem; opacity: 0.9; }

        /* ── 에러 화면 (토큰 만료 등) ── */
        #screen-error {
        }
        .error-icon { font-size: 64px; margin-bottom: 16px; }
        .error-title { font-size: 1.6rem; font-weight: 700; margin-bottom: 8px; }
        .error-msg { font-size: 1.2rem; opacity: 0.9; line-height: 1.5; }

        /* ── 연결됨 / 안내 화면 ── */
        #screen-connected {
        }
        .connected-guide-img {
            width: 85%;
            max-width: 400px;
            border-radius: 16px;
        }
        .connected-message {
            font-size: 1.6rem;
            line-height: 1.4;
            font-weight: 600;
            text-align: center;
            white-space: pre-line;
        }

        /* ── 세션 종료 화면 ── */
        #screen-revoked {
        }
        #screen-timeout {
        }

        /* ── 타임아웃 바 ── */
        .timeout-bar {
            position: fixed;
            top: 0;
            left: 0;
            height: 3px;
            background: #667eea;
            transition: width 1s linear;
            z-index: 100;
        }

        /* ── 디버그 패널 (개발용) ── */
        .debug-panel {
            display: none;
            position: fixed;
            bottom: 0;
            left: 0;
            right: 0;
            background: rgba(0,0,0,0.9);
            color: #0f0;
            font-family: monospace;
            font-size: 0.7rem;
            padding: 8px;
            max-height: 30vh;
            overflow-y: auto;
            z-index: 200;
        }
        .debug-panel.show { display: block; }
    </style>
</head>
<body>
    <!-- 타임아웃 진행 바 -->
    <div class="timeout-bar" id="timeout-bar" style="width: 100%;"></div>

    <!-- 1. 로딩 화면 -->
    <div class="screen active" id="screen-loading">
        <div class="spinner"></div>
        <div class="loading-text" style="font-weight:bold">기기를 확인하고 있습니다.</div>
    </div>

    <!-- 2. 에러 화면 -->
    <div class="screen" id="screen-error">
        <div class="error-icon">⚠️</div>
        <div class="error-title" id="error-title">연결할 수 없습니다</div>
        <div class="error-msg" id="error-msg">QR 코드를 다시 스캔해주세요.</div>
    </div>

    <!-- 3. 연결됨 / 안내 화면 -->
    <div class="screen" id="screen-connected">
        <img class="connected-guide-img" src="assets/web_guide.png" alt="가이드" />
        <div class="connected-message">본인의 휴대폰을
센서 위에 올려보세요</div>
    </div>

    <!-- 4. 세션 만료 (다른 사용자) -->
    <div class="screen" id="screen-revoked">
        <div class="error-title">체험이 종료되었습니다</div>
        <div class="error-msg">체험을 원하시면 QR 코드를 다시 스캔해주세요.</div>
    </div>

    <!-- 5. 타임아웃 -->
    <div class="screen" id="screen-timeout">
        <div class="error-title">체험이 종료되었습니다</div>
        <div class="error-msg">체험을 원하시면 QR 코드를 다시 스캔해주세요.</div>
    </div>

    <!-- 디버그 패널 -->
    <div class="debug-panel" id="debug-panel"></div>

    <!-- MQTT.js CDN -->
    <script src="https://unpkg.com/mqtt/dist/mqtt.min.js"></script>

    <!-- 기종 감지 (원본 device.html에서 추출) -->
    <script src="js/device-detector.js"></script>

    <!-- 세션/MQTT/활동 관리 -->
    <script src="js/app.js"></script>
</body>
</html>
